<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="~{fragments/client/head :: head}"></th:block>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">

    <style>
        /* CSS CHUNG CHO CARD */
        .card {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1); /* Vi·ªÅn nh·∫π cho n·ªÅn t·ªëi */
            background-color: transparent; /* ƒê·ªÉ hi·ªán m√†u n·ªÅn c·ªßa body */
        }

        .card:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5) !important;
            transform: translateY(-5px);
            border-color: #0d6efd; /* Hover vi·ªÅn xanh */
        }

        /* Badge gi·∫£m gi√° (G√≥c ph·∫£i) */
        .badge-discount {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #dc3545;
            color: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: 800;
            font-size: 0.85rem;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Gi√° c≈© g·∫°ch ngang */
        .price-old {
            color: #adb5bd !important;
            opacity: 0.8;
            font-size: 0.9rem;
            text-decoration: line-through;
            margin-left: 8px;
        }

        /* Badge Category */
        .badge-category {
            background-color: #0d6efd;
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-bottom: 10px;
        }

        .card.sold-out {
            opacity: 0.6;
            pointer-events: none;
        }

        .badge-status-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 8px 12px;
            font-weight: bold;
            border: 2px solid #fff;
            z-index: 20;
            color: white;
            background: #000;
        }

        .badge-coming-soon {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: #ffc107;
            color: #000;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: 700;
            z-index: 10;
        }

        .hover-zoom:hover {
            transform: scale(1.05);
            transition: transform 0.3s;
        }
    </style>
</head>

<body>

<nav th:replace="~{fragments/client/header :: header}"></nav>

<main class="flex-grow-1 bg-body-tertiary">

    <section class="py-5 text-center container border-bottom border-secondary">
        <div class="row py-lg-4">
            <div class="col-lg-6 col-md-8 mx-auto">
                <h1 class="fw-bold text-white display-5">NVK STORE</h1>
                <p class="lead text-secondary mb-4">C√¥ng ngh·ªá ƒë·ªânh cao - Gi√° c·∫£ ph·∫£i chƒÉng.</p>
                <a href="#products" class="btn btn-primary btn-lg fw-bold px-5 rounded-pill shadow-sm">Mua ngay</a>
            </div>
        </div>
    </section>

    <section class="container my-5" th:if="${listRandom != null && !listRandom.isEmpty()}">
        <h3 class="mb-4 text-white">üî• C√≥ th·ªÉ b·∫°n quan t√¢m</h3>

        <div class="owl-carousel owl-theme" id="nvkRandomSlider">
            <div class="item" th:each="sp : ${listRandom}">
                <div class="card h-100 shadow-sm border-0 overflow-hidden position-relative">

                    <div class="badge-discount"
                         th:if="${sp.nvkOldPrice != null && sp.nvkPrice != null && sp.nvkOldPrice > sp.nvkPrice}">
                        -[[${#numbers.formatInteger((sp.nvkOldPrice - sp.nvkPrice) / sp.nvkOldPrice * 100, 0)}]]%
                    </div>

                    <div class="position-relative bg-white text-center p-3">
                        <a th:href="@{'/nvk-product/detail/' + ${sp.nvkId}}" class="d-block">
                            <img th:src="${sp.nvkImgUrl != null ? sp.nvkImgUrl : '/images/no-image.png'}"
                                 class="card-img-top hover-zoom"
                                 style="height: 180px; object-fit: contain;"
                                 onerror="this.src='https://via.placeholder.com/200?text=No+Image'">
                        </a>
                    </div>

                    <div class="card-body d-flex flex-column bg-dark bg-opacity-25 pt-4">
                        <h5 class="card-title text-truncate fw-bold mb-2">
                            <a th:href="@{'/nvk-product/detail/' + ${sp.nvkId}}" class="text-decoration-none text-white"
                               th:text="${sp.nvkName}">T√™n SP</a>
                        </h5>

                        <div>
                            <span class="badge-category" th:text="${sp.nvkCategory?.nvkName ?: 'KH√ÅC'}">Category</span>
                        </div>

                        <div class="mb-3 mt-auto">
                            <span class="text-primary fw-bold fs-5">
                                <span th:if="${sp.nvkPrice != null}">[[${#numbers.formatDecimal(sp.nvkPrice, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</span>
                                <span th:unless="${sp.nvkPrice != null}">Li√™n h·ªá</span>
                            </span>

                            <span class="price-old"
                                  th:if="${sp.nvkOldPrice != null && sp.nvkPrice != null && sp.nvkOldPrice > sp.nvkPrice}">
                                [[${#numbers.formatDecimal(sp.nvkOldPrice, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´
                            </span>
                        </div>

                        <a th:href="@{'/nvk-product/detail/' + ${sp.nvkId}}"
                           class="btn btn-outline-primary btn-sm rounded-pill w-100 fw-bold">Xem ngay</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container py-5" id="products">
        <div class="d-flex align-items-center justify-content-between mb-4">
            <h3 class="fw-bold text-white m-0 border-start border-4 border-primary ps-3">S·∫£n ph·∫©m n·ªïi b·∫≠t</h3>
            <a href="/nvk-categories" class="btn btn-outline-primary btn-sm fw-bold">Xem t·∫•t c·∫£ <i
                    class="bi bi-arrow-right"></i></a>
        </div>

        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            <div class="col" th:each="p : ${nvkProducts}">
                <div class="card h-100 shadow-sm border-0 overflow-hidden position-relative"
                     th:classappend="${(p.nvkQuantity != null && p.nvkQuantity == 0 && p.nvkStatus == 1) || p.nvkStatus == 0} ? 'sold-out' : ''">

                    <div class="badge-discount"
                         th:if="${p.nvkOldPrice != null && p.nvkPrice != null && p.nvkOldPrice > p.nvkPrice}">
                        -[[${#numbers.formatInteger((p.nvkOldPrice - p.nvkPrice) / p.nvkOldPrice * 100, 0)}]]%
                    </div>

                    <div class="badge-status-center bg-danger" th:if="${p.nvkStatus == 0}">NG·ª™NG B√ÅN</div>
                    <div class="badge-status-center bg-dark"
                         th:if="${p.nvkQuantity != null && p.nvkQuantity == 0 && p.nvkStatus == 1}">H·∫æT H√ÄNG
                    </div>
                    <div class="badge-coming-soon" th:if="${p.nvkStatus == 2}">S·∫ÆP V·ªÄ</div>

                    <div class="position-relative bg-white text-center p-3">
                        <a th:href="@{/nvk-product/detail/{id}(id=${p.nvkId})}" class="d-block">
                            <img th:src="${p.nvkImgUrl != null ? p.nvkImgUrl : '/images/no-image.png'}"
                                 class="card-img-top hover-zoom" alt="Product Image"
                                 onerror="this.src='https://via.placeholder.com/200?text=No+Image'"
                                 style="height: 180px; object-fit: contain;">
                        </a>
                    </div>

                    <div class="card-body d-flex flex-column bg-dark bg-opacity-25 pt-4">
                        <h5 class="card-title text-truncate fw-bold mb-2 text-white" th:text="${p.nvkName}">T√™n s·∫£n
                            ph·∫©m</h5>

                        <div>
                            <span class="badge-category" th:text="${p.nvkCategory?.nvkName ?: 'KH√ÅC'}">Category</span>
                        </div>

                        <div class="mt-auto mb-3">
                            <span class="text-primary fw-bold fs-5">
                                <span th:if="${p.nvkPrice != null}">[[${#numbers.formatDecimal(p.nvkPrice, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´</span>
                                <span th:unless="${p.nvkPrice != null}">Li√™n h·ªá</span>
                            </span>

                            <span class="price-old"
                                  th:if="${p.nvkOldPrice != null && p.nvkPrice != null && p.nvkOldPrice > p.nvkPrice}">
                                [[${#numbers.formatDecimal(p.nvkOldPrice, 0, 'COMMA', 0, 'POINT')}]] ‚Ç´
                            </span>
                        </div>

                        <button th:if="${p.nvkStatus == 1 and p.nvkQuantity != null and p.nvkQuantity > 0}"
                                class="btn btn-primary btn-sm rounded-pill w-100 fw-bold shadow-sm"
                                th:onclick="'nvkAddToCart(' + ${p.nvkId} + ')'">
                            <i class="bi bi-cart-plus-fill me-1"></i>
                        </button>

                        <button th:if="${p.nvkStatus != 1 or p.nvkQuantity == null or p.nvkQuantity == 0}"
                                class="btn btn-secondary btn-sm rounded-pill w-100 fw-bold shadow-sm" disabled>
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-12 text-center text-muted py-5" th:if="${nvkProducts == null || nvkProducts.empty}">
                <p>Ch∆∞a c√≥ s·∫£n ph·∫©m.</p>
            </div>
        </div>
    </div>
</main>

<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast align-items-center text-bg-success border-0 shadow-lg" role="alert">
        <div class="d-flex">
            <div class="toast-body fw-bold" id="toastMessage">
                ƒê√£ th√™m v√†o gi·ªè! <a href="/nvk-cart" class="text-white text-decoration-underline ms-2 small">Xem gi·ªè
                h√†ng</a>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<footer th:replace="~{fragments/client/footer :: footer}"></footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>

<script>
    $(document).ready(function () {
        var owl = $("#nvkRandomSlider");
        if (owl.length > 0) {
            owl.owlCarousel({
                loop: false,
                margin: 20, nav: false, autoplay: true,
                responsive: {0: {items: 1}, 600: {items: 2}, 1000: {items: 4}}
            });
        }
    });

    function nvkAddToCart(productId) {
        fetch('/api/nvk-cart/add?productId=' + productId + '&quantity=1', {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                if (data.status === 'login_required') {
                    window.location.href = '/nvk-login';
                } else if (data.status === 'success') {
                    const toast = new bootstrap.Toast(document.getElementById('liveToast'));
                    toast.show();
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>

</body>
</html>